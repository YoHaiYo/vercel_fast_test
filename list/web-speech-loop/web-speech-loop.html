<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ì—°ì† ì¸ì‹ ì•ˆì •í™” ë²„ì „</title>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        margin-top: 40px;
      }
      #result {
        margin-top: 20px;
        background: #f8f8f8;
        padding: 15px;
        width: 80%;
        margin-inline: auto;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <h2>ğŸ™ï¸ ì™„ì „ ì—°ì† ì¸ì‹ (ìë™ ì¬ì‹œì‘ ë£¨í”„)</h2>
    <button id="startBtn">ì‹œì‘</button>
    <button id="stopBtn">ì •ì§€</button>
    <div id="result">ëŒ€ê¸° ì¤‘...</div>

    <script>
      window.SpeechRecognition =
        window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!window.SpeechRecognition) {
        alert("ì´ ë¸Œë¼ìš°ì €ëŠ” SpeechRecognition APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      }

      const recognition = new SpeechRecognition();
      recognition.lang = "ko-KR";
      recognition.continuous = true; // ì—¬ëŸ¬ ë¬¸ì¥ ì¸ì‹ ê°€ëŠ¥
      recognition.interimResults = true; // ì¤‘ê°„ ê²°ê³¼ ì‹¤ì‹œê°„ í‘œì‹œ

      const resultDiv = document.getElementById("result");
      let finalText = "";
      let recognizing = false;
      let autoRestart = false;

      recognition.onstart = () => {
        recognizing = true;
        console.log("ğŸ¤ ì¸ì‹ ì‹œì‘ë¨");
      };

      recognition.onresult = (event) => {
        let interim = "";
        for (let i = event.resultIndex; i < event.results.length; ++i) {
          const text = event.results[i][0].transcript;
          if (event.results[i].isFinal) {
            finalText += text + " ";
            console.log("âœ… ìµœì¢… ê²°ê³¼:", text);
          } else {
            interim += text;
          }
        }
        resultDiv.innerHTML = `
        <strong>ìµœì¢…:</strong> ${finalText}<br>
        <span style="color:gray;">ì¤‘ê°„: ${interim}</span>
      `;
      };

      recognition.onspeechend = () => {
        console.log("ğŸ¤« ë§ì†Œë¦¬ ì¤‘ë‹¨ (ìë™ ì¬ì‹œì‘ ëŒ€ê¸° ì¤‘)");
        recognizing = false;
      };

      recognition.onend = () => {
        console.log("ğŸ ì„¸ì…˜ ì¢…ë£Œë¨");
        recognizing = false;
        if (autoRestart) {
          // ğŸ” ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ê³  ìë™ ì¬ì‹œì‘
          setTimeout(() => {
            console.log("â© ìë™ ì¬ì‹œì‘ ì‹¤í–‰");
            recognition.start();
          }, 300);
        }
      };

      recognition.onerror = (e) => {
        console.warn("âš ï¸ ì—ëŸ¬ ë°œìƒ:", e.error);
        // ë„¤íŠ¸ì›Œí¬ë‚˜ ê¶Œí•œ ë¬¸ì œëŠ” ì¬ì‹œì‘í•˜ì§€ ì•ŠìŒ
        if (e.error === "not-allowed" || e.error === "network") {
          autoRestart = false;
        }
      };

      // ë²„íŠ¼ ì´ë²¤íŠ¸
      document.getElementById("startBtn").onclick = () => {
        autoRestart = true;
        finalText = "";
        recognition.start();
        console.log("â–¶ï¸ ìˆ˜ë™ ì‹œì‘");
      };

      document.getElementById("stopBtn").onclick = () => {
        autoRestart = false; // ìë™ ë£¨í”„ ì¤‘ì§€
        recognition.stop();
        console.log("â¹ ì •ì§€ ìš”ì²­ë¨");
      };
    </script>
  </body>
</html>
